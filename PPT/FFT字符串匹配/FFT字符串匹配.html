<!doctype html><html><head><meta charset=UTF-8><title>FFT字符串匹配 - By Reflective-FG</title><link rel=stylesheet href=https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdn.staticfile.org/prism/1.15.0/themes/prism.min.css><link rel=stylesheet href=https://cdn.staticfile.org/KaTeX/0.10.0-rc.1/katex.min.css><link rel=stylesheet href=https://cdn.staticfile.org/KaTeX/0.5.1/katex.min.css><link href=./css/chunk-vendors.4e4765ff.css rel=stylesheet></head><body><div><article id=webslides><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h1 class="text-landing text-shadow">FFT字符串匹配</h1><p class=text-intro>By Reflective-FG</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h2>前言</h2><p>字符串匹配，一个广泛而深刻的话题。</p><p>现有的字符串匹配算法有很多，例如 KMP，AC 自动机等等。但是，它们都是一位一位的处理，也就是说，基础操作是单个字符比较（哈希除外）。如果把整个字符串比较，效率是极其低下的。但将字符串转化为多项式后，多项式的运算无疑为整个字符串比较提供了绝佳的方法。</p><p>最知名但也最臭名昭著的多项式算法莫过于 FFT（快速傅里叶变换）了。实际上，它在字符串匹配方面也有很大的作用。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h2>前置芝士</h2><ul><li>多项式基础<ul><li>卷积</li><li>FFT</li></ul></li></ul><p>不会的左转 OI Wiki。</p><ul><li>一些基础的数学常识<ul><li>完全平方公式</li></ul></li></ul><p>不会的去翻数学书。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h2>正题</h2></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h3>普通字符串匹配</h3><p>设 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 为模式串，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 为文本串，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>n</mi><mo>=</mo><mo>∣</mo><mi>S</mi><mo>∣</mo><mo separator=true>,</mo><mi>m</mi><mo>=</mo><mo>∣</mo><mi>T</mi><mo>∣</mo></mrow><annotation encoding=application/x-tex>n=\lvert S \rvert,m=\lvert T \rvert</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit">n</span><span class=mrel>=</span><span class=mopen>∣</span><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=mclose>∣</span><span class=mpunct>,</span><span class="mord mathit">m</span><span class=mrel>=</span><span class=mopen>∣</span><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=mclose>∣</span></span></span></span>（字符串下标从 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span> 开始）。</p><p>显然，两个字符串相同，当且仅当它们每一位都相同，这是一句废话。</p><p>我们联想到初中一年级的一句重要的话：<strong>如果若干个非负数的和为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>，那么它们都为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span></strong>。</p><p><em>和为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span></em> 正好对应了 <em>每一位都相同</em>，所以很容易得出这个 <strong>完全匹配函数</strong>（很重要！之后要考）</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo>(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>x</mi><mo>−</mo><mi>n</mi><mo>+</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i=0}^{n-1} (S_i-T_{x-n+i+1})^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.8011130000000004em;></span><span class="strut bottom" style=height:3.0787820000000004em;vertical-align:-1.277669em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.1776689999999999em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mrel>=</span><span class="mord mathrm">0</span></span></span></span><span style=top:-0.000005000000000143778em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style=top:-1.2500050000000003em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mopen>(</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class=mbin>−</span><span class="mord mathit">n</span><span class=mbin>+</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mclose><span class=mclose>)</span><span class=vlist><span style=top:-0.413em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding=application/x-tex>f(x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span></span></span></span> 表示 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 与 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>T</mi><mrow><mo>[</mo><mi>x</mi><mo>−</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo separator=true>,</mo><mi>x</mi><mo>]</mo></mrow></msub></mrow><annotation encoding=application/x-tex>T_{[x-n+1, x]}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:1.03853em;vertical-align:-0.3551999999999999em;></span><span class="base textstyle uncramped"><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.18019999999999992em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class=mopen>[</span><span class="mord mathit">x</span><span class=mbin>−</span><span class="mord mathit">n</span><span class=mbin>+</span><span class="mord mathrm">1</span><span class=mpunct>,</span><span class="mord mathit">x</span><span class=mclose>]</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span> 的 <em>匹配值</em> 。</p><p>其中平方是为了保证每一项都是非负数。这样，只有每一项都为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>（即 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><msub><mi>T</mi><mrow><mi>x</mi><mo>+</mo><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=application/x-tex>S_i=T_{x+i-1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.891661em;vertical-align:-0.208331em;></span><span class="base textstyle uncramped"><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mrel>=</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class=mbin>+</span><span class="mord mathit">i</span><span class=mbin>−</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span>），<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding=application/x-tex>f(x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span></span></span></span> 才会为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>。</p><p>显然这个柿子不是很好化简，所以我们要对它进行一点点的变形。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><p>什么柿子容易计算呢？当然是卷积，即：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>x</mi></mrow></msub><msub><mi>A</mi><mi>i</mi></msub><msub><mi>B</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i+j=x} A_iB_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.050005em;></span><span class="strut bottom" style=height:2.463782em;vertical-align:-1.413777em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.177669em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathit" style=margin-right:0.05724em;>j</span><span class=mrel>=</span><span class="mord mathit">x</span></span></span></span><span style=top:-0.000005000000000032756em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit">A</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.05017em;>B</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05017em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p>然而之前那个柿子中，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.65952em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> 和 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>x</mi><mo>−</mo><mi>n</mi><mo>+</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=application/x-tex>x-n+i+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.74285em;vertical-align:-0.08333em;></span><span class="base textstyle uncramped"><span class="mord mathit">x</span><span class=mbin>−</span><span class="mord mathit">n</span><span class=mbin>+</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span></span></span></span> 加起来显然不是一个定值。如何把这个 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.65952em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> 消掉呢？</p><p>我们考虑把 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 整个串反转，这样原来的 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.65952em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> 就变成了 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>n</mi><mo>−</mo><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=application/x-tex>n-i-1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.74285em;vertical-align:-0.08333em;></span><span class="base textstyle uncramped"><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathit">i</span><span class=mbin>−</span><span class="mord mathrm">1</span></span></span></span>。</p><p>于是变成：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo>(</mo><msub><mi>S</mi><mrow><mi>n</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>x</mi><mo>−</mo><mi>n</mi><mo>+</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i=0}^{n-1} (S_{n-i+1}-T_{x-n+i+1})^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.8011130000000004em;></span><span class="strut bottom" style=height:3.0787820000000004em;vertical-align:-1.277669em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.1776689999999999em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mrel>=</span><span class="mord mathrm">0</span></span></span></span><span style=top:-0.000005000000000143778em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style=top:-1.2500050000000003em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mopen>(</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class=mbin>−</span><span class="mord mathit">n</span><span class=mbin>+</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mclose><span class=mclose>)</span><span class=vlist><span style=top:-0.413em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p>两个下标相加：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mo>(</mo><mi>n</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>)</mo><mo>+</mo><mo>(</mo><mi>x</mi><mo>−</mo><mi>n</mi><mo>+</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>)</mo><mo>=</mo><mi>x</mi></mrow><annotation encoding=application/x-tex>(n-i+1)+(x-n+i+1)=x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base displaystyle textstyle uncramped"><span class=mopen>(</span><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span><span class=mclose>)</span><span class=mbin>+</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mbin>−</span><span class="mord mathit">n</span><span class=mbin>+</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span><span class=mclose>)</span><span class=mrel>=</span><span class="mord mathit">x</span></span></span></span></span></p><p>好耶！消掉了！</p><p>于是那个柿子就可以写成：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>x</mi></mrow></msub><mo>(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>−</mo><msub><mi>T</mi><mi>j</mi></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i+j=x}(S_i-T_j)^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.050005em;></span><span class="strut bottom" style=height:2.463782em;vertical-align:-1.413777em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.177669em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathit" style=margin-right:0.05724em;>j</span><span class=mrel>=</span><span class="mord mathit">x</span></span></span></span><span style=top:-0.000005000000000032756em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mopen>(</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mclose><span class=mclose>)</span><span class=vlist><span style=top:-0.413em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p>用完全平方公式拆开：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>x</mi></mrow></msub><msubsup><mi>S</mi><mi>i</mi><mn>2</mn></msubsup><mo>−</mo><mn>2</mn><msub><mi>S</mi><mi>i</mi></msub><msub><mi>T</mi><mi>j</mi></msub><mo>+</mo><msubsup><mi>T</mi><mi>j</mi><mn>2</mn></msubsup></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i+j=x}S_i^2-2S_iT_j+T_j^2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.050005em;></span><span class="strut bottom" style=height:2.463782em;vertical-align:-1.413777em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.177669em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathit" style=margin-right:0.05724em;>j</span><span class=mrel>=</span><span class="mord mathit">x</span></span></span></span><span style=top:-0.000005000000000032756em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.247em;margin-left:-0.05764em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span style=top:-0.4129999999999999em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class="mord mathrm">2</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>+</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.24700000000000003em;margin-left:-0.13889em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span style=top:-0.41300000000000003em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p>显然第一项和第三项可以预处理得到，第二项就是 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi><mo>⋅</mo><mi>T</mi></mrow><annotation encoding=application/x-tex>S\cdot T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=mbin>⋅</span><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 中 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>x</mi></mrow><annotation encoding=application/x-tex>x</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.43056em;></span><span class="strut bottom" style=height:0.43056em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span> 次项的系数乘上 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo>−</mo><mn>2</mn></mrow><annotation encoding=application/x-tex>-2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.72777em;vertical-align:-0.08333em;></span><span class="base textstyle uncramped"><span class=mord>−</span><span class="mord mathrm">2</span></span></span></span>，只需要把 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 和 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 看成多项式，FFT 相乘即可。</p><p>复杂度 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mi>n</mi><mo>)</mo></mrow><annotation encoding=application/x-tex>O(n \log n)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.02778em;>O</span><span class=mopen>(</span><span class="mord mathit">n</span><span class=mop>lo<span style=margin-right:0.01389em;>g</span></span><span class="mord mathit">n</span><span class=mclose>)</span></span></span></span>。</p><p>还没有 KMP 快？别急，看接下来的。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h3>带通配符的字符串匹配</h3><p><strong>通配符</strong>，即可以匹配任意字符的字符（当然也可以匹配通配符）。</p><p>显然这种问题 KMP 就无能为力了。然而，对于 FFT 做法，我们仍然可以用相似的思路解决。</p><p>我们发现，原来 <strong>完全匹配函数</strong> 为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>，当且仅当对应的两个字符相同。但是，现在有了通配符，条件应该改为满足以下两个中任意一个：</p><ul><li>对应两个字符相同</li><li>对应两个字符中有任意一个是通配符</li></ul><p>很容易想到设通配符为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>（当然其它任何字符都不能为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>）。<strong>完全匹配函数</strong> 就变成了：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo>(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>x</mi><mo>−</mo><mi>n</mi><mo>+</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><msup><mo>)</mo><mn>2</mn></msup><mo>⋅</mo><msub><mi>S</mi><mi>i</mi></msub><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i=0}^{n-1} (S_i-T_{x-n+i+1})^2 \cdot S_iT_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.8011130000000004em;></span><span class="strut bottom" style=height:3.0787820000000004em;vertical-align:-1.277669em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.1776689999999999em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mrel>=</span><span class="mord mathrm">0</span></span></span></span><span style=top:-0.000005000000000143778em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style=top:-1.2500050000000003em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mopen>(</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class=mbin>−</span><span class="mord mathit">n</span><span class=mbin>+</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mclose><span class=mclose>)</span><span class=vlist><span style=top:-0.413em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>⋅</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><p>如果 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=application/x-tex>S_i=0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.83333em;vertical-align:-0.15em;></span><span class="base textstyle uncramped"><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mrel>=</span><span class="mord mathrm">0</span></span></span></span> 或 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=application/x-tex>T_i=0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.83333em;vertical-align:-0.15em;></span><span class="base textstyle uncramped"><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mrel>=</span><span class="mord mathrm">0</span></span></span></span>，那么 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding=application/x-tex>f(x)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span></span></span></span> 仍然为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>。</p><p>老规矩，反转 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span>：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo>(</mo><msub><mi>S</mi><mrow><mi>n</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>x</mi><mo>−</mo><mi>n</mi><mo>+</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><msup><mo>)</mo><mn>2</mn></msup><mo>⋅</mo><msub><mi>S</mi><mi>i</mi></msub><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i=0}^{n-1} (S_{n-i+1}-T_{x-n+i+1})^2 \cdot S_iT_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.8011130000000004em;></span><span class="strut bottom" style=height:3.0787820000000004em;vertical-align:-1.277669em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.1776689999999999em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mrel>=</span><span class="mord mathrm">0</span></span></span></span><span style=top:-0.000005000000000143778em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span style=top:-1.2500050000000003em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mopen>(</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class=mbin>−</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class=mbin>−</span><span class="mord mathit">n</span><span class=mbin>+</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathrm">1</span></span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mclose><span class=mclose>)</span><span class=vlist><span style=top:-0.413em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>⋅</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p>化成卷积形式：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>x</mi></mrow></msub><mo>(</mo><msub><mi>S</mi><mi>i</mi></msub><mo>−</mo><msub><mi>T</mi><mi>j</mi></msub><msup><mo>)</mo><mn>2</mn></msup><mo>⋅</mo><msub><mi>S</mi><mi>i</mi></msub><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i+j=x}(S_i-T_j)^2 \cdot S_iT_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.050005em;></span><span class="strut bottom" style=height:2.463782em;vertical-align:-1.413777em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.177669em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathit" style=margin-right:0.05724em;>j</span><span class=mrel>=</span><span class="mord mathit">x</span></span></span></span><span style=top:-0.000005000000000032756em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mopen>(</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mclose><span class=mclose>)</span><span class=vlist><span style=top:-0.413em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>⋅</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p>完全平方公式：</p><p><span class=katex-display><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>+</mo><mi>j</mi><mo>=</mo><mi>x</mi></mrow></msub><msubsup><mi>S</mi><mi>i</mi><mn>3</mn></msubsup><msub><mi>T</mi><mi>j</mi></msub><mo>−</mo><mn>2</mn><msubsup><mi>S</mi><mi>i</mi><mn>2</mn></msubsup><msubsup><mi>T</mi><mi>j</mi><mn>2</mn></msubsup><mo>+</mo><msub><mi>S</mi><mi>i</mi></msub><msubsup><mi>T</mi><mi>j</mi><mn>3</mn></msubsup></mrow><annotation encoding=application/x-tex>f(x)=\sum\limits_{i+j=x}S_i^3T_j-2S_i^2T_j^2+S_iT_j^3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:1.050005em;></span><span class="strut bottom" style=height:2.463782em;vertical-align:-1.413777em;></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style=margin-right:0.10764em;>f</span><span class=mopen>(</span><span class="mord mathit">x</span><span class=mclose>)</span><span class=mrel>=</span><span class="mop op-limits"><span class=vlist><span style=top:1.177669em;margin-left:0em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathit" style=margin-right:0.05724em;>j</span><span class=mrel>=</span><span class="mord mathit">x</span></span></span></span><span style=top:-0.000005000000000032756em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span><span class="op-symbol large-op mop">∑</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.247em;margin-left:-0.05764em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span style=top:-0.4129999999999999em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">3</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>−</span><span class="mord mathrm">2</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.247em;margin-left:-0.05764em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span style=top:-0.4129999999999999em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.24700000000000003em;margin-left:-0.13889em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span style=top:-0.41300000000000003em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mbin>+</span><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.24700000000000003em;margin-left:-0.13889em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span style=top:-0.41300000000000003em;margin-right:0.05em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">3</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span></span></p><p>看起来很复杂？但每一项还是卷积的形式，于是就用很多次 FFT 解决了。</p><p>复杂度 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mi>n</mi><mo>)</mo></mrow><annotation encoding=application/x-tex>O(n \log n)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.02778em;>O</span><span class=mopen>(</span><span class="mord mathit">n</span><span class=mop>lo<span style=margin-right:0.01389em;>g</span></span><span class="mord mathit">n</span><span class=mclose>)</span></span></span></span>。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h2>例题</h2></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h3>模板题</h3><p>残缺的字符串</p><ul><li><a href=https://www.luogu.com.cn/problem/P4173 target=_blank>Luogu 传送门</a></li><li><a href=https://darkbzoj.cc/problem/4259 target=_blank>黑暗爆炸OJ 传送门</a></li></ul><h4>做法</h4><p>就是模板题，按上面方法做就完了。</p><p>注意数组大小好好算，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>e</mi><mi>p</mi><mi>s</mi></mrow><annotation encoding=application/x-tex>eps</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.43056em;></span><span class="strut bottom" style=height:0.625em;vertical-align:-0.19444em;></span><span class="base textstyle uncramped"><span class="mord mathit">e</span><span class="mord mathit">p</span><span class="mord mathit">s</span></span></span></span> 我取的 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=application/x-tex>1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span> 过了。</p><p>常数有点大，吸氧能过。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h3>练习题</h3></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><p>CF528D Fuzzy Search</p><ul><li><a href=https://www.luogu.com.cn/problem/CF528D target=_blank>Luogu 传送门</a></li><li><a href=https://codeforces.com/contest/528/problem/D target=_blank>Codeforces 传送门</a></li></ul><h4>题目大意</h4><p>有两个字符串 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi><mo separator=true>,</mo><mi>T</mi></mrow><annotation encoding=application/x-tex>S,T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.8777699999999999em;vertical-align:-0.19444em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=mpunct>,</span><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span>，长度分别为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>n</mi><mo separator=true>,</mo><mi>m</mi></mrow><annotation encoding=application/x-tex>n,m</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.43056em;></span><span class="strut bottom" style=height:0.625em;vertical-align:-0.19444em;></span><span class="base textstyle uncramped"><span class="mord mathit">n</span><span class=mpunct>,</span><span class="mord mathit">m</span></span></span></span>，字符集为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo>{</mo><mi>A</mi><mo separator=true>,</mo><mi>C</mi><mo separator=true>,</mo><mi>G</mi><mo separator=true>,</mo><mi>T</mi><mo>}</mo></mrow><annotation encoding=application/x-tex>\{A,C,G,T\}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class=mopen>{</span><span class="mord mathit">A</span><span class=mpunct>,</span><span class="mord mathit" style=margin-right:0.07153em;>C</span><span class=mpunct>,</span><span class="mord mathit">G</span><span class=mpunct>,</span><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=mclose>}</span></span></span></span>，和一个整数 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=application/x-tex>k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.69444em;></span><span class="strut bottom" style=height:0.69444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.03148em;>k</span></span></span></span>。</p><p>我们称 <em><span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 在 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 的第 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.65952em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> 位出现了</em>，当且仅当把 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 的首字符和 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 的第 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.65952em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> 个字符对齐后，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 中的每一个字符能够在 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 中找到一个位置偏差不超过 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>k</mi></mrow><annotation encoding=application/x-tex>k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.69444em;></span><span class="strut bottom" style=height:0.69444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.03148em;>k</span></span></span></span> 的相同字符。</p><p>即对于所有的 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>j</mi><mo>∈</mo><mo>[</mo><mn>1</mn><mo separator=true>,</mo><mi>n</mi><mo>]</mo></mrow><annotation encoding=application/x-tex>j \in[1,n]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span><span class=mrel>∈</span><span class=mopen>[</span><span class="mord mathrm">1</span><span class=mpunct>,</span><span class="mord mathit">n</span><span class=mclose>]</span></span></span></span>，都存在一个 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>p</mi><mo>∈</mo><mo>[</mo><mn>1</mn><mo separator=true>,</mo><mi>m</mi><mo>]</mo></mrow><annotation encoding=application/x-tex>p \in [1,m]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit">p</span><span class=mrel>∈</span><span class=mopen>[</span><span class="mord mathrm">1</span><span class=mpunct>,</span><span class="mord mathit">m</span><span class=mclose>]</span></span></span></span> 使得 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>∣</mi><mo>(</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo>)</mo><mo>−</mo><mi>p</mi><mi mathvariant=normal>∣</mi><mo>≤</mo><mi>k</mi></mrow><annotation encoding=application/x-tex>|(i+j-1)-p| \leq k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathrm">∣</span><span class=mopen>(</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathit" style=margin-right:0.05724em;>j</span><span class=mbin>−</span><span class="mord mathrm">1</span><span class=mclose>)</span><span class=mbin>−</span><span class="mord mathit">p</span><span class="mord mathrm">∣</span><span class=mrel>≤</span><span class="mord mathit" style=margin-right:0.03148em;>k</span></span></span></span> 且 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>S</mi><mi>p</mi></msub><mo>=</mo><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>S_p=T_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.969438em;vertical-align:-0.286108em;></span><span class="base textstyle uncramped"><span class=mord><span class="mord mathit" style=margin-right:0.05764em;>S</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.05764em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">p</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span><span class=mrel>=</span><span class=mord><span class="mord mathit" style=margin-right:0.13889em;>T</span><span class=vlist><span style=top:0.15em;margin-right:0.05em;margin-left:-0.13889em;><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style=margin-right:0.05724em;>j</span></span></span><span class=baseline-fix><span class="fontsize-ensurer reset-size5 size5"><span style=font-size:0em;>​</span></span>​</span></span></span></span></span></span> 。</p><p>请求出 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 在 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 中出现的次数。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h4>做法</h4><p>首先把四种字母分开来考虑，最后取四个集合的交即可。</p><p>接下来假设只考虑字母 <code>A</code>，其余三个同理。</p><p>先把 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 和 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 除了 <code>A</code> 的部分都去掉（即空白），其余位置涂色。</p><p>接下来对 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 处理：由于 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 中的一个 <code>A</code>（假设在第 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>i</mi></mrow><annotation encoding=application/x-tex>i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.65952em;></span><span class="strut bottom" style=height:0.65952em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span> 位）可以影响到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo>[</mo><mi>i</mi><mo>−</mo><mi>k</mi><mo separator=true>,</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo>]</mo></mrow><annotation encoding=application/x-tex>[i-k,i+k]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class=mopen>[</span><span class="mord mathit">i</span><span class=mbin>−</span><span class="mord mathit" style=margin-right:0.03148em;>k</span><span class=mpunct>,</span><span class="mord mathit">i</span><span class=mbin>+</span><span class="mord mathit" style=margin-right:0.03148em;>k</span><span class=mclose>]</span></span></span></span> 这些位置，所以把这些位置全都涂色。</p><p>接下来直接匹配即可。对于 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 上有颜色的位置，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 对应位置一定要有颜色；而对于 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 上空白的位置，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 对应位置可以有颜色，也可以是空白。</p><p>于是把 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.13889em;>T</span></span></span></span> 的涂色部分看成 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=application/x-tex>1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span>，空白部分看成 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>2</mn></mrow><annotation encoding=application/x-tex>2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span></span></span></span>，<span class=katex><span class=katex-mathml><math><semantics><mrow><mi>S</mi></mrow><annotation encoding=application/x-tex>S</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.68333em;></span><span class="strut bottom" style=height:0.68333em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.05764em;>S</span></span></span></span> 的涂色部分看成 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>1</mn></mrow><annotation encoding=application/x-tex>1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span></span></span></span>，空白部分看成 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn></mrow><annotation encoding=application/x-tex>0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.64444em;></span><span class="strut bottom" style=height:0.64444em;vertical-align:0em;></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span></span></span></span>（即通配符）。</p><p>复杂度 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mi>n</mi><mo>)</mo></mrow><annotation encoding=application/x-tex>O(n \log n)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=strut style=height:0.75em;></span><span class="strut bottom" style=height:1em;vertical-align:-0.25em;></span><span class="base textstyle uncramped"><span class="mord mathit" style=margin-right:0.02778em;>O</span><span class=mopen>(</span><span class="mord mathit">n</span><span class=mop>lo<span style=margin-right:0.01389em;>g</span></span><span class="mord mathit">n</span><span class=mclose>)</span></span></span></span>。</p></div></section><section slide class="slide bg-white aligncenter"><div class=wrap wrap=true><h2>THE END</h2></div></section></article></div><script src=https://cdn.staticfile.org/echarts/4.8.0/echarts.min.js></script><script>window.pluginsOptions = {}



    window.webslidesOptions = {}


document.addEventListener('DOMContentLoaded', () => {
    let isPrintMode = false;
    if(~location.search.indexOf('print-pdf')){
        isPrintMode = true;
        WebSlides.registerPlugin('scroll', function(){});
    }
    const wsOptions = {
        loop: false
    };
    if(window.webslidesOptions){
        for (let i in webslidesOptions){
            if(webslidesOptions.hasOwnProperty(i)){
                wsOptions[i] = webslidesOptions[i];
            }
        }
    }
    const ws = new WebSlides(wsOptions)

    window.wsInstance = ws;
    if(isPrintMode){
        ws.slides.forEach(s=>s.show())
    }
}, false)</script><script src=./js/chunk-vendors.js></script><script src=./js/Test.js></script></body></html>